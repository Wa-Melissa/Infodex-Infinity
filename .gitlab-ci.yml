image: node:22

stages:
  - build
  - makeself

variables:
  NODE_ENV: production

before_script:
  - apt-get update && apt-get install -y dpkg-dev fakeroot zip makeself
  - npm install --include=dev

build_application:
#  only:
#    - tags 
  stage: build
  script:
    - npm run make
    - echo "echo Starting Infodex-Infinity... ; ./infodex-infinity --no-sandbox >/dev/null 2>&1" > out/infodex-infinity-linux-x64/makeselfstartup.sh
  artifacts:
    paths:
      - out/make/

build_makeself:
#  only:
#    - tags 
  stage: makeself
  script:
    - mkdir -p out/makeself/x64/
    - echo "echo Starting Infodex-Infinity... ; ./infodex-infinity --no-sandbox >/dev/null 2>&1" > out/infodex-infinity-linux-x64/makeselfstartup.sh
    - makeself --nomd5 --nocrc --nox11 out/infodex-infinity-linux-x64/ out/makeself/x64/infodex-infinity.run infodex-infinity sh makeselfstartup.sh
  artifacts:
    paths:
      - out/makeself